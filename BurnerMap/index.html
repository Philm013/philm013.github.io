<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BurnerMap v13</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <link rel="stylesheet" href="src/style.css"/>
</head>
<body class="dark">

    <!-- STROBE OVERLAY -->
    <div id="strobe-overlay" onclick="app.toggleStrobe()">
        <div class="absolute inset-0 flex items-center justify-center">
            <h1 class="text-black font-black text-4xl bg-white p-4">TAP TO STOP</h1>
        </div>
    </div>

    <!-- AUDIO ELEMENTS -->
    <audio id="sound-msg" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.m4a"></audio>
    <audio id="sound-alert" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.m4a"></audio>

    <!-- HEADER -->
    <div class="header-left glass">
        <button onclick="app.toggleTheme()" class="text-yellow-500 mr-3"><i id="theme-icon" class="fa-solid fa-sun"></i></button>
        <div class="flex flex-col leading-none">
            <span class="font-black text-xs tracking-wide">BURNER<span class="text-blue-500">MAP</span></span>
            <span id="conn-status" class="text-[9px] opacity-60 font-bold mt-1 tracking-widest uppercase">OFFLINE</span>
        </div>
        <div id="status-dot" class="w-2 h-2 rounded-full bg-red-500 shadow-[0_0_8px_red] ml-3"></div>
    </div>

    <div class="header-right">
        <button onclick="app.toggleStrobe()" class="icon-btn glass text-white bg-slate-800 border-2 border-white/20"><i class="fa-solid fa-bolt"></i></button>
        <button onclick="app.toggleQR()" class="icon-btn glass"><i class="fa-solid fa-qrcode"></i></button>
    </div>

    <!-- MAP VIEW -->
    <div id="view-map">
        <div id="map"></div>
        
        <!-- OPS STACK (Controls) -->
        <div class="ops-stack">
            <button onclick="app.toggleSatellite()" class="ops-btn glass text-green-400" title="Satellite Mode"><i class="fa-solid fa-layer-group"></i></button>
            <button onclick="app.toggleWaypointMode()" id="btn-poi" class="ops-btn glass text-yellow-500" title="Add POI"><i class="fa-solid fa-map-pin"></i></button>
            <button onclick="app.sendSonar()" class="ops-btn glass text-red-500" title="Sonar Ping"><i class="fa-solid fa-bullseye"></i></button>
            <button id="btn-focus" onclick="app.forceFocus()" class="hidden ops-btn bg-blue-600 text-white shadow-lg shadow-blue-500/50" title="Force Group Focus"><i class="fa-solid fa-magnet"></i></button>
        </div>

        <div id="host-hint" class="absolute top-24 left-1/2 -translate-x-1/2 z-[10] glass px-4 py-2 rounded-full text-xs font-bold opacity-0 pointer-events-none transition-opacity">Host: Double-Tap to Flag</div>
    </div>

    <!-- CHAT VIEW -->
    <div id="view-chat">
        <div id="chat-header" class="absolute top-0 left-0 right-0 z-30 p-4 glass hidden"></div>
        <div id="chat-scroll" class="no-scrollbar">
            <div id="msg-list" class="flex flex-col gap-4"></div>
        </div>
        <div class="absolute bottom-[110px] left-4 right-4 z-30 glass p-2 rounded-3xl flex gap-2">
            <input type="text" id="msg-input" placeholder="Message..." autocomplete="off" class="flex-1 bg-transparent px-4 outline-none text-base">
            <button onclick="app.sendMessage(event)" class="w-10 h-10 bg-blue-600 rounded-full text-white shadow-lg"><i class="fa-solid fa-arrow-up"></i></button>
        </div>
    </div>

    <!-- NAV DOCK -->
    <nav class="nav-dock glass">
        <button onclick="app.switchTab('map')" id="btn-map" class="nav-btn active"><i class="fa-solid fa-map-location-dot"></i></button>
        <div class="w-px h-8 bg-gray-500/30 my-auto mx-1"></div>
        <button onclick="app.switchTab('chat')" id="btn-chat" class="nav-btn relative">
            <i class="fa-solid fa-comments"></i>
            <div id="unread-dot" class="absolute top-4 right-4 w-2.5 h-2.5 bg-red-500 rounded-full hidden border-2 border-white"></div>
        </button>
        <div class="w-px h-8 bg-gray-500/30 my-auto mx-1"></div>
        <button onclick="app.burn()" class="nav-btn text-red-500"><i class="fa-solid fa-power-off"></i></button>
    </nav>

    <!-- WAYPOINT NAME MODAL -->
    <div id="modal-waypoint-name" class="fixed inset-0 z-[100] bg-black/80 hidden flex flex-col items-center justify-center p-6" onclick="if(event.target === this) this.classList.add('hidden');">
        <div class="glass p-6 rounded-2xl w-full max-w-xs text-center">
            <h3 class="text-xl font-bold mb-4">Name your POI</h3>
            <div class="bg-white/10 p-2 rounded-xl mb-4">
                <input type="text" id="waypoint-name-input" class="w-full bg-transparent text-white p-2 text-center font-bold text-lg outline-none" placeholder="E.g., The Man">
            </div>
            <button id="waypoint-save-btn" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold text-lg">SAVE</button>
        </div>
    </div>

    <!-- ACTION SHEET -->
    <div id="modal-actions" class="fixed inset-0 z-[60] bg-black/60 hidden" onclick="app.hideActions()">
        <div id="action-sheet" class="action-sheet glass">
            <div class="w-12 h-1.5 bg-gray-500 rounded-full mx-auto mb-4"></div>
            <div id="action-content" class="text-center"></div>
            <div id="action-buttons" class="flex flex-col gap-2 mt-4"></div>
        </div>
    </div>

    <!-- ONBOARDING -->
    <div id="modal-onboarding" class="fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center p-6 transition-opacity duration-500">
        <div class="w-24 h-24 bg-gradient-to-tr from-gray-800 to-gray-900 rounded-3xl flex items-center justify-center shadow-2xl border border-white/10 mb-8">
            <i class="fa-solid fa-ghost text-5xl text-white"></i>
        </div>
        <h1 class="text-4xl font-black text-white mb-2">BURNER<span class="text-blue-500">MAP</span></h1>
        <p class="text-gray-500 text-xs uppercase font-bold tracking-[0.2em] mb-10">v13 Ops Edition</p>
        <div class="bg-white/10 p-2 rounded-2xl mb-4 w-full max-w-xs">
            <input type="text" id="username-input" class="w-full bg-transparent text-white p-4 text-center font-bold text-xl outline-none" placeholder="CODENAME">
        </div>
        <button onclick="app.startSession()" class="w-full max-w-xs bg-white text-black py-4 rounded-2xl font-black text-lg active:scale-95 transition-transform">ENTER</button>
    </div>

    <!-- QR -->
    <div id="modal-qr" class="fixed inset-0 z-[90] hidden bg-black/95 flex flex-col items-center justify-center p-6 gap-4" onclick="app.toggleQR()">
        <div class="bg-white p-8 rounded-[32px] text-center" onclick="event.stopPropagation()">
            <div id="qrcode" class="flex justify-center p-2 mb-4"></div>
            <p class="text-black font-bold">Scan to Join</p>
        </div>
        <button onclick="app.copyLink(event)" class="bg-white text-black px-6 py-3 rounded-full font-bold text-lg">Copy Link</button>
    </div>

    <!-- TOAST -->
    <div id="toast" class="fixed top-24 left-1/2 -translate-x-1/2 glass px-6 py-3 rounded-full text-sm font-bold opacity-0 transition-all pointer-events-none translate-y-4 z-[200]">Notification</div>

    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script src="src/state.js"></script>
    <script src="src/ui.js"></script>
    <script src="src/map.js"></script>
    <script src="src/network.js"></script>
    <script src="src/app.js"></script>
</body>
</html>