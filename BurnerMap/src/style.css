
        :root {
            --bg-color: #f1f5f9; --text: #0f172a; --glass: rgba(255,255,255,0.85); --border: rgba(0,0,0,0.1);
            --accent: #3b82f6; --danger: #ef4444; --success: #10b981;
        }
        body.dark { 
            --bg-color: #050505; --text: #fff; --glass: rgba(20,20,20,0.85); --border: rgba(255,255,255,0.15);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body {
            margin: 0; background: var(--bg-color); color: var(--text); font-family: 'Inter', sans-serif;
            width: 100vw; height: 100dvh; overflow: hidden; position: fixed;
            transition: background 0.3s;
        }

        /* --- GLASS UI --- */
        .glass { background: var(--glass); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--border); box-shadow: 0 8px 32px rgba(0,0,0,0.2); }
        
        /* --- MAP & LAYERS --- */
        #view-map { position: absolute; inset: 0; z-index: 1; visibility: hidden; }
        #map { width: 100%; height: 100%; background: #000; z-index: 1; }

        /* OPS STACK (Right Side Controls) */
        .ops-stack {
            position: absolute; top: 100px; right: 16px; z-index: 20;
            display: flex; flex-direction: column; gap: 12px;
        }
        .ops-btn {
            width: 48px; height: 48px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 18px; color: var(--text); transition: transform 0.1s;
        }
        .ops-btn:active { transform: scale(0.9); }

        /* --- CHAT SLIDE --- */
        #view-chat {
            position: absolute; inset: 0; z-index: 30; background: var(--bg-color);
            transform: translate3d(100%, 0, 0); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            display: flex; flex-direction: column;
            padding-top: 70px; /* Pushes content down */
        }
        #chat-header {
            top: 70px; /* Position below main header */
        }
        #chat-scroll { flex: 1; overflow-y: auto; padding: 120px 20px 180px 20px; }

        /* --- ROSTER SLIDE --- */
        #view-roster {
            position: absolute; inset: 0; z-index: 30; background: var(--bg-color);
            transform: translate3d(-100%, 0, 0); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
            padding-top: 70px;
            overflow-y: auto;
        }
        
        /* --- NAV DOCK --- */
        .nav-dock {
            position: absolute; bottom: max(env(safe-area-inset-bottom), 30px);
            left: 50%; transform: translateX(-50%); z-index: 40;
            border-radius: 36px; padding: 8px; display: flex; gap: 8px;
        }
        .nav-btn {
            width: 60px; height: 60px; border-radius: 26px; display: flex; align-items: center; justify-content: center;
            font-size: 22px; color: #94a3b8; transition: all 0.2s;
        }
        .nav-btn.active { background: rgba(125,125,125,0.2); color: var(--text); }

        /* --- HEADER --- */
        .header-left { position: absolute; top: max(env(safe-area-inset-top), 16px); left: 16px; z-index: 50; padding: 8px 16px; border-radius: 99px; display: flex; align-items: center; gap: 12px; }
        .header-right { position: absolute; top: max(env(safe-area-inset-top), 16px); right: 16px; z-index: 50; display: flex; gap: 10px; }
        .icon-btn { width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* --- UTILS --- */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .marker-arrow {
            width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent;
            border-bottom: 10px solid #fff; position: absolute; top: -8px; left: 50%; transform: translateX(-50%);
        }
        .crosshair-cursor { cursor: crosshair; }

        /* --- SONAR --- */
        @keyframes sonar-pulse {
            0% { transform: scale(0.1); opacity: 0.8; }
            80% { transform: scale(1); opacity: 0; }
            100% { opacity: 0; }
        }
        .sonar-wave {
                    background: rgba(239, 68, 68, 0.5);
                    border-radius: 50%;
                    animation: sonar-pulse 2s ease-out;
                }
        
                .mention {
                            font-weight: bold;
                            color: #3b82f6;
                            cursor: pointer;
                        }
                
                        #mention-suggestions {
                            max-height: 150px;
                            overflow-y: auto;
                        }
                        .mention-item {
                            padding: 8px 12px;
                            cursor: pointer;
                            border-radius: 8px;
                        }
                        .mention-item:hover {
                            background: rgba(125,125,125,0.2);
                        }
                            /* --- ACTION SHEET --- */
        .action-sheet {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            padding: 16px;
            padding-bottom: max(env(safe-area-inset-bottom), 16px);
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        #modal-actions { transition: background-color 0.3s; }
        #modal-actions.show { background-color: rgba(0,0,0,0.6); }
        #modal-actions:not(.show) { pointer-events: none; }
        #modal-actions.show .action-sheet {
            transform: translateY(0);
        }
    