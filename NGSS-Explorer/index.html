<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGSS 3D + PE Explorer</title>
	<link rel="stylesheet" href="styles.css"/>
 
</head><body>
    <div class="app-layout">
        <header class="app-header">
            <div class="header-title-wrapper">
                <h1>NGSS 3D + PE Explorer</h1>
            </div>
            <input type="text" id="search-input" placeholder="Search current view...">
            <div class="header-actions">
                <button id="settings-btn" title="AI Settings">Settings</button>
                <button id="reset-app-btn" title="Reset all filters and views">Reset</button>
            </div>
        </header>
        
        <div class="page-container">
            <!-- The <aside> sidebar is now removed and will be handled by a modal -->
            <main id="main-content">
                <div class="app-nav">
                    <button id="nav-pe-explorer" class="nav-btn">PE Explorer</button>
                    <button id="nav-threed-explorer" class="nav-btn">3D Explorer</button>
                    <button id="nav-matrix-view" class="nav-btn">Matrix View</button>
                </div>
                <div id="top-bar" style="display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
                    <div id="navigation-controls" style="display: none;"><button id="back-btn">&larr; Back</button></div>
                    <div id="active-pe-filter-tag"><span></span><button id="clear-pe-filter-btn" title="Clear PE Filter">&times;</button></div>
                </div>
                <div id="pe-explorer" class="explorer-view">
                    <div id="bundle-controls" style="display: none;">
                        <span id="bundle-count">0 PEs selected</span>
                        <button id="view-bundle-btn" title="View details for all selected PEs">View Bundle Details</button>
                        <button id="save-bundle-btn" title="Save current selection as a named bundle">Save Bundle</button>
                        <button id="clear-bundle-btn" title="Deselect all PEs">Clear Selection</button>
                    </div>
                    <div class="table-container">
                        <!-- Container for new mobile card layout -->
                        <div id="pe-cards-container" class="pe-cards-container"></div>
                        <!-- Original table for desktop -->
                        <table id="pe-explorer-table">
                            <thead><tr><th style="width: 2em;"><input type="checkbox" id="pe-bundle-select-all" title="Select/Deselect all visible"></th><th>PE ID</th><th>Description</th><th>Grade</th><th>Topic</th></tr></thead>
                            <tbody id="pe-table-body"></tbody>
                        </table>
                    </div>
                </div>
                <div id="bundle-view"></div>
                <div id="threed-explorer" class="explorer-view">
                    <div class="table-container">
                        <table id="threed-explorer-table">
                            <thead><tr><th style="width: 30%;">Dimension / Element</th><th style="width: 17.5%;"><div class="th-content-wrapper"><span>Grades K-2</span><button class="col-toggle-btn" data-col="2" title="Isolate this column">&lt;&gt;</button></div></th><th style="width: 17.5%;"><div class="th-content-wrapper"><span>Grades 3-5</span><button class="col-toggle-btn" data-col="3" title="Isolate this column">&lt;&gt;</button></div></th><th style="width: 17.5%;"><div class="th-content-wrapper"><span>Grades 6-8</span><button class="col-toggle-btn" data-col="4" title="Isolate this column">&lt;&gt;</button></div></th><th style="width: 17.5%;"><div class="th-content-wrapper"><span>Grades 9-12</span><button class="col-toggle-btn" data-col="5" title="Isolate this column">&lt;&gt;</button></div></th></tr></thead>
                            <tbody id="threed-table-body"></tbody>
                        </table>
                    </div>
                </div>
                <div id="matrix-view" class="explorer-view">
                    <div id="matrix-controls">
                        <button id="select-matrix-rows-btn" class="filter-btn active">Select/Refine Rows (3D Elements)</button>
                    </div>
                    <div id="matrix-table-container" class="table-container" style="display:none;">
                        <table id="matrix-table">
                            <thead id="matrix-table-head"></thead>
                            <tbody id="matrix-table-body"></tbody>
                        </table>
                    </div>
                    <div id="matrix-placeholder">
                        <div>
                            <h2>Welcome to the Matrix View</h2>
                            <p>This view helps visualize progressions of 3D Elements across grade levels.<br>Click the button above to select the 3D Elements you want to see as rows in the matrix.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- This container is moved outside the main flow to hold the sidebar controls -->
    <div style="display:none;" id="sidebar-controls-storage">
        <div class="controls">
            <h2>Filters</h2>
            <div id="sidebar-filters-container">
                <div id="pe-filters-all">
                        <div id="bundle-filter-container" style="margin-top: 0.75rem;">
                        <h2>Filter by Bundle <span id="manage-bundles-btn" class="manage-btn filter-btn">Manage</span></h2>
                        <div id="bundle-filters" class="filter-group"></div>
                    </div>
                    <div id="grade-filters-container" style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed var(--border-color);">
                        <div class="filter-group-label">Filter by Grade:</div>
                        <div id="grade-filters" class="filter-group"></div>
                    </div>
                    <div id="topic-filters-container" style="display: none; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed var(--border-color);">
                        <div class="filter-group-label">Filter by Topic:</div>
                        <div id="topic-filters" class="filter-group"></div>
                    </div>
                    <div id="pe-element-filters-container">
                        <div class="filter-group-label">Filter by 3D Element (must contain all selected):</div>
                        <div id="active-element-filters"></div>
                        <button id="add-element-filter-btn" class="filter-btn" style="margin-top: 0.5rem;">+ Add Element Filter</button>
                    </div>
                </div>
                <div id="threed-filters-all">
                    <div id="dimension-filters-container">
                        <div class="filter-group-label">Filter by Dimension:</div>
                        <div id="dimension-filters" class="filter-group"></div>
                        <div id="sub-dimension-filters-container" style="display: none;">
                            <div class="filter-group-label">Filter by Element / Core Idea:</div>
                            <div id="sub-dimension-filters" class="filter-group"></div>
                            <div id="dci-minor-filters-container" style="display: none; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border-color);">
                                <div class="filter-group-label">Filter by Component Idea:</div>
                                <div id="dci-minor-filters" class="filter-group"></div>
                            </div>
                            <div id="clear-sub-filters-btn">Clear Sub-filters</div>
                        </div>
                    </div>
                </div>
            </div>
                <div id="results-count"></div>
        </div>
    </div>

    <!-- MODALS & POPUPS -->
    <div id="filter-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Filters</h2>
                <button class="modal-close-btn" title="Close">&times;</button>
            </div>
            <div class="modal-body" id="filter-modal-body">
                <!-- The original sidebar controls will be moved here by JS -->
            </div>
            <div class="modal-footer">
                <button id="apply-filters-btn" class="filter-btn active">Show Results</button>
            </div>
        </div>
    </div>
    <div id="related-pe-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h2 id="related-pe-modal-title"></h2><button class="modal-close-btn" title="Close">&times;</button></div><div class="modal-body"><p>This element is found in the following PEs:</p><ul id="related-pe-list"></ul></div></div></div>
    <div id="element-filter-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h2>Select 3D Element to Filter By</h2><button class="modal-close-btn" title="Close">&times;</button></div><div class="modal-body"><div class="modal-body-grid" id="element-filter-choices"></div></div></div></div>
    <div id="bundle-manager-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h2>Manage Saved Bundles</h2><button class="modal-close-btn" title="Close">&times;</button></div><div class="modal-body"><ul id="bundle-manager-list" class="bundle-manager-list"></ul></div></div></div>
    <div id="save-bundle-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h2>Save Bundle</h2><button class="modal-close-btn" title="Close">&times;</button></div><div class="modal-body" id="save-bundle-modal-body"><label for="bundle-name-input">Bundle Name:</label><input type="text" id="bundle-name-input" placeholder="e.g., First Grade Forces Unit"><div class="modal-actions"><button id="cancel-save-bundle-btn" class="filter-btn">Cancel</button><button id="confirm-save-bundle-btn" class="filter-btn active">Save</button></div></div></div></div>
    <div id="matrix-row-select-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h2>Select Matrix Rows</h2><button class="modal-close-btn" title="Close">&times;</button></div><div class="modal-body"><div class="modal-body-grid" id="matrix-row-choices"></div></div><div class="modal-footer"><button id="update-matrix-btn" class="filter-btn active">Update Matrix</button></div></div></div>
    <div id="evidence-statements-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h2 id="evidence-statements-modal-title">Evidence Statements</h2><button class="modal-close-btn" title="Close">&times;</button></div><div class="modal-body ai-editable-content" id="evidence-statements-modal-body" data-part="evidenceStatements"></div><div class="modal-footer"><div class="ai-controls"><button id="analyze-es-btn" class="filter-btn active">Analyze with AI</button><button id="deconstruct-facets-btn" class="filter-btn">Deconstruct into 3D Facets</button><button class="filter-btn reset-btn reset-analysis-btn">Reset</button></div><button id="copy-es-html-btn" class="filter-btn">Copy HTML</button></div></div></div>
    <div id="facet-decomposition-modal" class="modal-overlay"><div class="modal-content" style="max-width: 900px;"><div class="modal-header"><h2 id="facet-modal-title"></h2><button class="modal-close-btn" title="Close">&times;</button></div><div class="modal-body" id="facet-modal-body"><div id="facet-tables-container"></div></div><div class="modal-footer"><button id="refresh-facets-btn" class="filter-btn reset-btn">Refresh with AI</button><button id="copy-facets-btn" class="filter-btn">Copy as Text</button><button id="close-facets-btn" class="filter-btn">Close</button></div></div></div>
    <div id="settings-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h2>Settings</h2><button class="modal-close-btn" title="Close">&times;</button></div><div class="modal-body" id="settings-modal-body"><div class="setting-group"><label for="api-key-input">Gemini API Key</label><input type="password" id="api-key-input" placeholder="Enter your Google AI Studio API Key"><p style="font-size: 0.85em; color: #555; margin-top: 0.5rem;">Your API key is saved only in your browser's local storage.</p></div><div class="setting-group"><label for="ai-model-select">AI Model</label><select id="ai-model-select"><option value="gemini-flash-latest">gemini-flash-latest</option><option value="gemini-2.5-pro">gemini-2.5-pro</option></select></div><div class="setting-group"><label>Cache Management</label><p style="font-size: 0.85em; color: #555; margin-top: 0; margin-bottom: 0.5rem;">App data and AI results are cached in your browser. Clearing caches can fix issues but may slow down the next page load.</p><div class="cache-buttons"><button id="clear-ai-cache-btn" class="filter-btn reset-btn">Clear AI Cache</button><button id="clear-data-cache-btn" class="filter-btn reset-btn">Clear Data Cache</button></div></div></div><div class="modal-footer"><button id="save-settings-btn" class="filter-btn active">Save Settings</button></div></div></div>
    
    <div id="ai-edit-toolbar">
        <button class="sep-btn" data-action="set-class" data-value="sep" title="Set as SEP">S</button>
        <button class="sep-btn" data-action="set-class" data-value="sep-underline" title="Set as SEP (Underlined)">
            S <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3M4 21h16"/></svg>
        </button>
        <div class="separator"></div>
        <button class="dci-btn" data-action="set-class" data-value="dci" title="Set as DCI">D</button>
        <button class="dci-btn" data-action="set-class" data-value="dci-underline" title="Set as DCI (Underlined)">
            D <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3M4 21h16"/></svg>
        </button>
        <div class="separator"></div>
        <button class="ccc-btn" data-action="set-class" data-value="ccc" title="Set as CCC">C</button>
        <button class="ccc-btn" data-action="set-class" data-value="ccc-underline" title="Set as CCC (Underlined)">
            C <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3M4 21h16"/></svg>
        </button>
        <div class="separator"></div>
        <button data-action="unwrap" title="Remove Formatting" style="background-color: rgba(255,255,255,0.1);">
             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21H7z"/><path d="M22 21H7"/><path d="m5 12 5 5"/></svg>
        </button>
    </div>
    <div id="resize-handle-start" class="resize-handle"></div>
    <div id="resize-handle-end" class="resize-handle"></div>
    
    <script type="module" src="app.js"></script>
    
    <!-- FLOATING ACTION BUTTONS for Mobile -->
    <div class="fab-container">
        <button id="fab-bundle-view" class="fab" title="View Bundle">
            <span id="fab-bundle-count">0</span>
        </button>
        <button id="fab-filter" class="fab" title="Filters">&#9776; Filters</button>
    </div>
    
    <!-- NEW MOBILE BOTTOM NAVIGATION -->
    <nav class="bottom-nav">
        <button id="bottom-nav-pe" class="bottom-nav-btn active" data-view="pe">
            <span>PE Explorer</span>
        </button>
        <button id="bottom-nav-3d" class="bottom-nav-btn" data-view="3d">
            <span>3D Explorer</span>
        </button>
        <button id="bottom-nav-matrix" class="bottom-nav-btn" data-view="matrix">
            <span>Matrix View</span>
        </button>
    </nav>
</body>
</html>