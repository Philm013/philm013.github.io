     :root {
            --header-bg: #f7f7f7; --border-color: #e5e7eb; --row-hover-bg: #f0f5fa; --highlight-bg: #fff3bf;
            --dimension-header-bg: #004488; --dimension-header-text: #ffffff; --element-header-bg: #eef5fc;
            --dci-major-bg: #333; --dci-major-text: #fff; --text-color: #2c3e50; --body-bg: #f9fafb;
            --sidebar-bg: #ffffff; --copy-feedback-bg: #28a745; --button-bg: #f3f4f6; --button-hover-bg: #e5e7eb;
            --active-filter-bg: #e6f4ff; --active-filter-border: #007bff; --modal-overlay-bg: rgba(0, 0, 0, 0.6);
            --nav-btn-active-bg: #fff; --nav-btn-active-border: #005a9c; --search-highlight: #ffe082;
            --pe-highlight-row-bg: #e6f4ff; --pe-highlight-row-border: #005a9c;
            --pe-highlight-specific-bg: #ffecb3; --pe-highlight-specific-border: #f59e0b;
        }
        @keyframes flash { 0% { background-color: var(--pe-highlight-specific-bg); } 50% { background-color: inherit; } 100% { background-color: var(--pe-highlight-specific-bg); } }
        html, body { height: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: var(--body-bg); color: var(--text-color); line-height: 1.5; font-size: 15px; }
        .app-layout { display: flex; flex-direction: column; height: 100vh; }
        .app-header { display: flex; align-items: center; justify-content: space-between; gap: 1rem; padding: 0.75rem 1.5rem; background-color: var(--sidebar-bg); border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
        .header-title-wrapper { display: flex; align-items: center; gap: 0.75rem; }
        .header-actions { display: flex; align-items: center; gap: 0.75rem; }
        h1 { padding: 0; margin: 0; background-color: transparent; border: none; font-size: 1.4rem; font-weight: 600; }
        #reset-app-btn, #settings-btn { padding: 0.3em 0.8em; border: 1px solid var(--border-color); border-radius: 6px; background-color: var(--button-bg); cursor: pointer; font-size: 0.9em; font-weight: 500; }
        #reset-app-btn:hover, #settings-btn:hover { background-color: var(--button-hover-bg); }
        .page-container { display: flex; gap: 1rem; padding: 1rem; flex-grow: 1; min-height: 0; }
        #sidebar { width: 320px; flex-shrink: 0; background-color: var(--sidebar-bg); border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid var(--border-color); display: flex; flex-direction: column; }
        #main-content { flex-grow: 1; min-width: 0; display: flex; flex-direction: column; gap: 0.75rem; }
        .app-nav { flex-shrink: 0; display: flex; gap: 0.5rem; padding: 1rem 1rem 0.25rem; border-bottom: 1px solid var(--border-color); }
        .nav-btn { flex-grow: 1; padding: 0.6rem 1rem; border: 1px solid transparent; border-bottom-color: var(--border-color); border-radius: 6px 6px 0 0; background-color: var(--button-bg); cursor: pointer; font-size: 1.1em; font-weight: 500; text-align: center; }
        .nav-btn.active { background-color: var(--nav-btn-active-bg); border-color: var(--border-color); border-bottom-color: var(--nav-btn-active-bg); color: var(--nav-btn-active-border); font-weight: 600; }
        .controls { display: flex; flex-direction: column; gap: 0.75rem; padding: 1rem; flex-grow: 1; overflow-y: auto; min-height: 0; }
        .controls h2 { margin: 0 0 0.5rem 0; font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center; }
        .controls h2 .manage-btn { font-size: 0.8em; font-weight: 500; cursor: pointer; }
        .controls label, .filter-group-label { font-weight: 600; font-size: 0.9em; margin-bottom: 0.25rem; display: block; color: #555; }
        #search-input { padding: 0.6em 0.8em; border: 1px solid var(--border-color); border-radius: 6px; font-size: 1em; width: 350px; box-sizing: border-box; }
        .filter-group { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; }
        .filter-btn { padding: 0.5em; border: 1px solid var(--border-color); border-radius: 6px; background-color: var(--button-bg); cursor: pointer; font-size: 0.85em; text-align: center; }
        .filter-btn:hover { background-color: var(--button-hover-bg); }
        .filter-btn.active { background-color: var(--dimension-header-bg); color: var(--dimension-header-text); border-color: var(--dimension-header-bg); font-weight: 600; }
        .filter-btn.reset-btn { background-color: #fce8e6; border-color: #f7c5c0; color: #c5221f;}
        .filter-btn:hover:disabled, .filter-btn:disabled { background-color: var(--button-bg); color: #999; cursor: not-allowed; }
        #sub-dimension-filters-container { margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed var(--border-color); }
        .sub-filter-group h4 { font-size: 0.9em; margin: 0.8em 0 0.3em; color: #333; }
        #clear-sub-filters-btn { font-size: 0.8em; color: #005a9c; cursor: pointer; text-align: right; margin-top: 0.5rem; display: none; }
        #results-count { margin-top: 0.5rem; font-size: 0.9em; color: #555; }
        .explorer-view { display: none; flex-direction: column; flex-grow: 1; min-height: 0; }
        .explorer-view.is-visible { display: flex; }
        .table-container { background-color: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid var(--border-color); border-radius: 8px; overflow: auto; flex-grow: 1; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 0.6em 1em; text-align: left; vertical-align: top; border-bottom: 1px solid var(--border-color); }
        thead th { background-color: var(--header-bg); font-weight: 600; position: sticky; top: 0; z-index: 10; }
        tbody tr:not(.pe-details-row):hover { background-color: var(--row-hover-bg); }
        .search-highlight { background-color: var(--search-highlight); font-weight: bold; border-radius: 2px; }
        #navigation-controls { display: flex; gap: 1rem; align-items: center; }
        #back-btn { padding: 0.3em 0.8em; border: 1px solid var(--border-color); border-radius: 6px; background-color: var(--button-bg); cursor: pointer; font-weight: 600; }
        #active-pe-filter-tag { display: none; padding: 0.5rem 1rem; background-color: var(--active-filter-bg); border: 1px solid var(--active-filter-border); border-radius: 6px; font-size: 0.95em; justify-content: space-between; align-items: center; }
        #active-pe-filter-tag span { font-weight: 600; }
        #clear-pe-filter-btn { background: none; border: none; font-size: 1.5rem; line-height: 1; cursor: pointer; color: #888; padding: 0 0.5rem; }
        #threed-explorer-table td:not(:last-child), #threed-explorer-table th:not(:last-child) { border-right: 1px solid var(--border-color); }
        .th-content-wrapper { display: flex; justify-content: space-between; align-items: center; }
        .col-toggle-btn { background: transparent; border: 1px solid var(--border-color); cursor: pointer; font-size: 0.9em; padding: 2px 6px; border-radius: 4px; margin-left: 8px; }
        .col-toggle-btn.active { background-color: var(--dimension-header-bg); color: var(--dimension-header-text); border-color: var(--dimension-header-bg); }
        .dimension-header td { background-color: var(--dimension-header-bg); color: var(--dimension-header-text); font-size: 1.1em; font-weight: 600; position: sticky; top: 40px; z-index: 9; }
        .element-header td:first-child, .dci-minor-header td:first-child { background-color: var(--element-header-bg); font-weight: 600; }
        .dci-major-header td { background-color: var(--dci-major-bg); color: var(--dci-major-text); font-weight: 600; position: sticky; top: 40px; z-index: 9; }
        .dci-minor-header td:first-child { padding-left: 2em; }
        td .item { margin-bottom: 0.5em; padding: 0.25rem; border-radius: 4px; transition: background-color 0.2s ease-in-out; }
        td .item strong { display: block; color: #005a9c; font-weight: 600; }
        .copyable, .item, .statement { cursor: copy; position: relative; }
        .copyable::after, .item::after, .statement::after { content: 'Copied!'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: var(--copy-feedback-bg); color: white; padding: 0.25em 0.75em; border-radius: 1em; font-size: 0.9em; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; z-index: 100; }
        .copyable.copied::after, .item.copied::after, .statement.copied::after { opacity: 1; }
        .pe-highlight-row { background-color: var(--pe-highlight-row-bg); }
        .pe-highlight-row td:first-child { border-left: 4px solid var(--pe-highlight-row-border); }
        .pe-highlight-specific { background-color: var(--pe-highlight-specific-bg) !important; box-shadow: 0 0 0 2px var(--pe-highlight-specific-border) inset; }
        .scroll-target { animation: flash 1.5s 1; }
        #threed-explorer-table.col-isolated th, #threed-explorer-table.col-isolated td { display: none; }
        #threed-explorer-table.col-isolated th:first-child, #threed-explorer-table.col-isolated td:first-child { display: table-cell; width: 25% !important; }
        #threed-explorer-table.isolate-col-2 th:nth-child(2), #threed-explorer-table.isolate-col-2 td:nth-child(2),
        #threed-explorer-table.isolate-col-3 th:nth-child(3), #threed-explorer-table.isolate-col-3 td:nth-child(3),
        #threed-explorer-table.isolate-col-4 th:nth-child(4), #threed-explorer-table.isolate-col-4 td:nth-child(4),
        #threed-explorer-table.isolate-col-5 th:nth-child(5), #threed-explorer-table.isolate-col-5 td:nth-child(5) { display: table-cell; width: 75% !important; }
        #pe-explorer-table .pe-main-row { cursor: pointer; scroll-margin-top: 45px; }
        #pe-explorer-table .pe-main-row.expanded { background-color: var(--element-header-bg); font-weight: 600;}
        .pe-details-row { display: none; }
        .pe-details-row.is-visible { display: table-row; }
        .pe-details-row > td { background-color: #fdfdfd; padding: 0 !important; }
        .pe-details-wrapper { padding: 1rem 1.5rem; border-top: 2px solid var(--dimension-header-bg); }
        .pe-description-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem; margin-bottom: 1rem; }
        .pe-description-header h3 { margin: 0; font-size: 1.1em; color: var(--dimension-header-bg); flex-grow: 1; }
        .ai-controls { display: flex; gap: 0.5rem; }
        .pe-description-text { font-size: 1.05em; line-height: 1.6; }
        .pe-details-info-box { background-color: #f9f9f9; border-left: 4px solid #ccc; padding: 0.75rem 1.5rem; margin-bottom: 1rem; }
        .pe-details-info-box h4 { margin: 0 0 0.25rem; font-size: 1em; color: #555; }
        .pe-details-info-box p { margin: 0; }
        .pe-details-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; }
        .pe-details-column h4 { margin: 0 0 0.5rem; font-size: 1em; color: #333; border-bottom: 2px solid var(--dimension-header-bg); padding-bottom: 0.25rem; }
        .pe-details-column ul { margin: 0; padding-left: 0; list-style: none; }
        .pe-details-column li { margin-bottom: 0.75rem; font-size: 0.95em; }
        .clickable-element-link { color: var(--dimension-header-bg); font-weight: 600; cursor: pointer; }
        .clickable-element-link:hover { text-decoration: underline; }
        .pe-nav-link { color: var(--dimension-header-bg); font-weight: 600; cursor: pointer; text-decoration: none; }
        .pe-nav-link:hover { text-decoration: underline; }
        .pe-details-actions { margin-top: 1rem; text-align: right; display: flex; gap: 0.5rem; justify-content: flex-end; }
        .pe-details-connections { margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color); }
        .pe-connections-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1rem 2rem; }
        .pe-connections-section h4 { margin: 0 0 0.5rem; font-size: 1em; color: var(--dimension-header-bg); border-bottom: 1px solid var(--border-color); padding-bottom: 0.25rem; }
        .pe-connections-section ul { list-style: none; padding: 0; margin: 0; }
        .pe-connections-section li { font-size: 0.9em; margin-bottom: 0.5rem; line-height: 1.4; }
        .pe-connections-section li strong { color: #333; }
        .pe-connections-section p { font-size: 0.9em; margin: 0; line-height: 1.4; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--modal-overlay-bg); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .modal-overlay.is-visible { display: flex; }
        .modal-content { background: var(--sidebar-bg); border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 800px; display: flex; flex-direction: column; max-height: 90vh; }
        .modal-header { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; cursor: move; }
        .modal-header h2 { margin: 0; font-size: 1.3rem; }
        .modal-close-btn { background: none; border: none; font-size: 2rem; line-height: 1; cursor: pointer; color: #888; }
        .modal-body { padding: 1.5rem; overflow-y: auto; }
        .modal-body ul { list-style: none; padding: 0; margin: 0; }
        .modal-body li { padding: 0.5rem 0.75rem; border-radius: 4px; }
        .modal-body li:not(:last-child) { border-bottom: 1px solid var(--border-color); }
        .modal-body li strong { color: var(--dimension-header-bg); }
        .modal-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--border-color); text-align: right; display: flex; justify-content: flex-end; gap: 0.5rem;}
        #settings-modal-body .setting-group { margin-bottom: 1.5rem; }
        #settings-modal-body label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        #settings-modal-body input, #settings-modal-body select { width: 100%; padding: 0.6rem; border-radius: 4px; border: 1px solid var(--border-color); box-sizing: border-box; font-size: 1em; }
        #settings-modal-body .cache-buttons { display: flex; gap: 0.5rem; }
        
        /* --- EVIDENCE STATEMENTS, FACETS & AI STYLES --- */
        #evidence-statements-modal-body { line-height: 1.5; padding-bottom: 1rem; }
        .statement, .es-entry { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.4rem 0.6rem; border-radius: 6px; transition: background-color 0.15s ease-in-out; margin: 2px 0; position: relative; }
        .statement:hover, .es-entry:hover { background-color: var(--row-hover-bg); }
        .es-entry.copyable::after { left: 30px; }
        .es-marker { flex-shrink: 0; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; border: 1px solid var(--border-color); background-color: #fff; color: #666; font-size: 0.8em; font-weight: 600; line-height: 1; margin-top: 0.1em; font-family: monospace; }
        .es-text { flex-grow: 1; margin: 0; }
        .es-heading-entry { margin: 1.5rem 0 0.5rem; padding: 0 0 0.5rem 0; border-bottom: 2px solid var(--border-color); border-radius: 0; align-items: center; }
        .es-heading-entry:first-child { margin-top: 0; }
        .es-heading-entry:hover { background-color: transparent; }
        .es-heading-entry .es-marker { background-color: var(--dimension-header-bg); color: #fff; border-color: var(--dimension-header-bg); width: 28px; height: 28px; font-size: 1em; }
        .es-heading-text { font-size: 1.1em; color: var(--dimension-header-bg); font-weight: 600; margin: 0; }
        .es-item { margin-left: 0; }
        .es-nested-item { margin-left: 2rem; }
        .es-nested-item .es-marker { border-style: dashed; color: #888; font-weight: normal; font-size: 0.75em; }
        .es-deeply-nested-item { margin-left: 4rem; }
        .ai-editable-content { position: relative; }
        .ai-editable-content span { cursor: pointer; }
        .sep { color: #0072bc; font-weight: 500; }
        .dci { color: #f26522; font-weight: 500; }
        .ccc { color: #0b9444; font-weight: 500; }
        .sep-underline { text-decoration: underline; text-decoration-thickness: 3px; text-decoration-color: #0072bc; }
        .dci-underline { text-decoration: underline; text-decoration-thickness: 3px; text-decoration-color: #f26522; }
        .ccc-underline { text-decoration: underline; text-decoration-thickness: 3px; text-decoration-color: #0b9444; }
        .facet-table { width: 100%; border-collapse: separate; border-spacing: 0; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 1.5rem; background-color: #fdfdfd; }
        .facet-table th, .facet-table td { border-bottom: 1px solid var(--border-color); }
        .facet-table tr:last-child td { border-bottom: none; }
        .facet-table thead th { background-color: var(--element-header-bg); padding: 0.75rem 1rem; text-align: left; border-top-left-radius: 8px; border-top-right-radius: 8px;}
        .facet-table thead .facet-element-id { font-size: 1.1em; color: var(--dimension-header-bg); }
        .facet-table thead .facet-dimension-name { font-size: 0.9em; color: #555; }
        .facet-table thead .facet-element-text { font-size: 0.95em; font-weight: normal; padding-top: 0.5rem; }
        .facet-table tbody td { padding: 0; }
        .facet-item-row { display: flex; align-items: flex-start; padding: 0.6rem 1rem;}
        .facet-item-row .facet-num { width: 2.5em; text-align: right; color: #888; flex-shrink: 0; padding-right: 0.8em;}
        
        #ai-edit-toolbar {
            position: absolute; display: none; background-color: #2c3e50; border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2); padding: 6px; z-index: 3000;
            gap: 4px; align-items: center; transition: opacity 0.1s ease-in-out, transform 0.1s ease-in-out;
            transform: translateY(10px);
        }
        #ai-edit-toolbar.is-visible { display: flex; transform: translateY(0); }
        #ai-edit-toolbar button {
            border: 1px solid transparent; cursor: pointer; padding: 6px 8px;
            border-radius: 6px; display: flex; align-items: center; justify-content: center;
            color: #fff; font-size: 14px; font-weight: bold; gap: 4px; line-height: 1;
            transition: all 0.15s ease-in-out;
        }
        #ai-edit-toolbar button.sep-btn { background-color: #0072bc; }
        #ai-edit-toolbar button.dci-btn { background-color: #f26522; }
        #ai-edit-toolbar button.ccc-btn { background-color: #0b9444; }
        #ai-edit-toolbar button.sep-btn:hover { background-color: #008be2; }
        #ai-edit-toolbar button.dci-btn:hover { background-color: #ff8142; }
        #ai-edit-toolbar button.ccc-btn:hover { background-color: #0ec254; }
        #ai-edit-toolbar button.active {
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
            transform: translateY(1px);
        }
        #ai-edit-toolbar .separator { width: 1px; height: 20px; background-color: rgba(255,255,255,0.2); margin: 0 4px; }
        
        .resize-handle {
            display: none; position: absolute; width: 24px; height: 24px;
            background-color: var(--dimension-header-bg); border: 2px solid #fff;
            border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            z-index: 3001; cursor: ew-resize; user-select: none;
            transform: translate(-50%, -50%);
        }
        .clickable-pe-link { cursor: pointer; }
        .clickable-pe-link:hover { background-color: var(--row-hover-bg); }
        #sidebar-toggle, #page-overlay { display: none; }
        #bundle-controls { padding: 0.5rem 1rem; background-color: var(--header-bg); border-bottom: 1px solid var(--border-color); display: flex; flex-wrap: wrap; gap: 0.5rem 1rem; align-items: center; position: sticky; top: 0; z-index: 11; }
        #bundle-controls button { padding: 0.3em 0.8em; border: 1px solid var(--border-color); border-radius: 6px; background-color: var(--button-bg); cursor: pointer; }
        #bundle-controls button:hover { background-color: var(--button-hover-bg); }
        #bundle-view { background-color: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid var(--border-color); border-radius: 8px; overflow-y: auto; flex-grow: 1; padding: 1.5rem; display: none; flex-direction: column;}
        #bundle-view .bundle-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        #bundle-view .bundle-header-actions { display: flex; gap: 0.5rem; align-items: center;}
        .pe-bundle-item { border: 1px solid var(--border-color); border-radius: 6px; padding: 1rem; margin-bottom: 1rem; background-color: #fdfdfd; }
        .bundle-summary { border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem; background-color: var(--element-header-bg); }
        .bundle-summary h3 { margin-top: 0; }
        .bundle-summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem 2rem; }
        .bundle-summary-col ul { padding-left: 1.2rem; margin: 0; }
        .bundle-summary-col li { font-size: 0.9em; margin-bottom: 0.25rem; }
        .bundle-summary-col li strong { color: var(--dimension-header-bg); }
        .bundle-summary-connections-grid { margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem 2rem; }
        .dci-group h4 { margin-bottom: 1rem; }
        .dci-sub-group:not(:first-child) { margin-top: 1.5rem; }
        h5.dci-sub-header { margin: 0 0 0.5rem 0; font-size: 0.95em; color: #444; border-bottom: 1px solid #ccc; padding-bottom: 0.25rem; font-weight: 600; }
        .bundle-summary-col li { font-size: 0.9em; margin-bottom: 0.5rem; }
        #pe-element-filters-container { margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed var(--border-color); }
        #active-element-filters { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem; }
        .element-filter-tag { display: inline-flex; align-items: center; background-color: var(--active-filter-bg); border: 1px solid var(--active-filter-border); border-radius: 4px; padding: 0.2rem 0.2rem 0.2rem 0.6rem; font-size: 0.85em; }
        .element-filter-tag button { background: none; border: none; font-size: 1.2rem; line-height: 1; cursor: pointer; color: #888; padding: 0 0.2rem; }
        .modal-body-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; }
        .modal h4 { margin: 0 0 0.5rem; font-size: 1em; color: #333; }
        .element-choice { cursor: pointer; padding: 0.4rem; border-radius: 4px; }
        .element-choice:hover { background-color: var(--row-hover-bg); }
        .bundle-manager-list li { display: flex; justify-content: space-between; align-items: center; }
        .bundle-manager-list .actions button { font-size: 0.8em; margin-left: 0.5em; }
        .bundle-manager-list .bundle-name { font-weight: 600; }
        #save-bundle-modal-body { display: flex; flex-direction: column; gap: 0.5rem; }
        #save-bundle-modal-body input { font-size: 1.1em; padding: 0.5em; border-radius: 4px; border: 1px solid var(--border-color); }
        #save-bundle-modal-body .modal-actions { text-align: right; margin-top: 1rem; }
        /* MATRIX VIEW STYLES */
        #matrix-controls { padding: 0.5rem 0; background-color: var(--header-bg); border-bottom: 1px solid var(--border-color); display: flex; gap: 1rem; align-items: center; }
        #matrix-table th, #matrix-table td { min-width: 120px; white-space: normal; }
        #matrix-table th:first-child, #matrix-table td:first-child { min-width: 250px; max-width: 350px; font-weight: 600; }
        #matrix-table thead th { vertical-align: bottom; }
        #matrix-table thead th:first-child, #matrix-table tbody td:first-child { position: sticky; left: 0; background-color: var(--header-bg); border-right: 1px solid var(--border-color); }
        #matrix-table thead th:first-child { z-index: 11; }
        #matrix-table tbody td:first-child { z-index: 1; background-color: var(--element-header-bg); }
        .pe-matrix-link { display: inline-block; background-color: var(--button-bg); color: var(--dimension-header-bg); font-weight: 600; padding: 0.2rem 0.5rem; border-radius: 4px; margin: 0.2rem; cursor: pointer; border: 1px solid var(--border-color); }
        .pe-matrix-link:hover { background-color: var(--button-hover-bg); text-decoration: underline; }
        #matrix-placeholder { flex-grow: 1; display: flex; align-items: center; justify-content: center; text-align: center; background-color: #fff; border: 1px solid var(--border-color); border-radius: 8px; }
        #matrix-row-select-modal .modal-body-grid { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        #matrix-row-select-modal label { display: block; padding: 0.4rem; border-radius: 4px; cursor: pointer; }
        #matrix-row-select-modal label:hover { background-color: var(--row-hover-bg); }
        #matrix-row-select-modal input { margin-right: 0.5rem; }
        
        #pe-cards-container { display: none; } /* Hidden on desktop */

        @media (max-width: 767px) {
            #ai-edit-toolbar {
                position: fixed;
                bottom: 0; left: 0; right: 0;
                border-radius: 0;
                width: 100%;
                box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
                justify-content: space-around;
                padding: 8px;
                transform: translateY(100%);
            }
             #ai-edit-toolbar.is-visible { transform: translateY(0); }
        }

        @media print {
            body, .app-layout { overflow: visible; height: auto; }
            h1, .app-header, #sidebar, #sidebar-toggle, #top-bar, #pe-explorer, #threed-explorer, .bundle-header-actions, .pe-details-actions, .modal-footer, #ai-edit-toolbar, .resize-handle { display: none !important; }
            .page-container { display: block; padding: 0; }
            #main-content, #bundle-view { display: block !important; flex-grow: 1; box-shadow: none; border: none; padding: 0; }
            .bundle-summary { page-break-after: avoid; }
            .pe-bundle-item { page-break-inside: avoid; page-break-after: avoid; }
        }

        /* --- NEW MOBILE UI OVERHAUL STYLES --- */
        .bottom-nav {
            display: none; /* Hidden on desktop */
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: var(--sidebar-bg);
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }
        .bottom-nav-btn {
            width: 33.33%;
            height: 100%;
            background: none;
            border: none;
            border-top: 3px solid transparent;
            color: #555;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .bottom-nav-btn.active {
            color: var(--nav-btn-active-border);
            border-top-color: var(--nav-btn-active-border);
            font-weight: 600;
        }
        .fab-container {
            display: none; /* Hidden on desktop */
            position: fixed;
            bottom: 75px;
            right: 1rem;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .fab {
            background-color: var(--dimension-header-bg);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 0.8rem 1rem;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        #fab-bundle-view {
            display: none; /* Hidden until items are selected */
            background-color: #0b9444;
        }
        #fab-bundle-count {
            background-color: rgba(255,255,255,0.3);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }

        /* Card layout for PE Explorer on mobile */
        .pe-cards-container {
            display: none; /* Hidden on desktop by default */
            flex-direction: column;
            gap: 0.75rem;
        }
        .pe-card {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-left: 5px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .pe-card.is-selected {
            border-left-color: var(--dimension-header-bg);
            background-color: #f5faff;
        }
        .pe-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }
        .pe-card-id {
            font-weight: 700;
            font-size: 1.1em;
            color: var(--dimension-header-bg);
            cursor: pointer;
        }
        .pe-card-checkbox {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
        }
        .pe-card-meta {
            font-size: 0.85em;
            color: #555;
            margin-top: 0.5rem;
            display: flex;
            gap: 1rem;
        }

        /* Overhaul the existing media query */
        @media (max-width: 992px) {
            body { padding-bottom: 60px; /* Space for the bottom nav */ }
            html, body { overflow: visible; } /* Allow scrolling on main body */
            .app-layout { overflow-y: auto; height: auto; }
            .page-container { flex-direction: column; }
            
            /* Hide desktop-only elements */
            #sidebar, #sidebar-toggle, #page-overlay, .app-nav, #bundle-controls { display: none !important; }

            /* Show mobile-only elements */
            .bottom-nav, .fab-container { display: flex; }

            .app-header { padding-left: 1rem; }
            .header-title-wrapper { display: none; }
            .app-header #search-input { flex-grow: 1; width: auto; }

            /* Change PE table to cards */
            #pe-explorer-table { display: none; }
            #pe-cards-container { display: flex; }
            .table-container { background-color: transparent; border: none; box-shadow: none; }
            
            /* Make modals full screen */
            .modal-content {
                width: 100%;
                max-width: 100%;
                height: 100%;
                max-height: 100%;
                border-radius: 0;
            }
        }