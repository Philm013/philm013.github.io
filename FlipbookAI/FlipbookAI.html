<!DOCTYPE html>
<html lang="en">
 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flipbook Anything!</title>
    <script src="pdf.min.js"></script>
    <link href="pdf_viewer.min.css" rel="stylesheet" type="text/css" />
    <link id="theme-style" rel="stylesheet" href="fbai_dark.css" type="text/css">
	 <link rel="icon" type="image/x-icon" href="favicon.ico"> 
	  <!-- Google AI SDK Loader -->
	     <!-- Font Awesome for Icons (Optional but nice for chat icon) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script type="module">
        try {
            const sdkUrl = "https://cdn.jsdelivr.net/npm/@google/generative-ai/dist/index.mjs";
            console.log(`Attempting to load Google AI SDK from: ${sdkUrl}`);
            const module = await import(sdkUrl);
            const AiClass = module.GoogleGenerativeAI;
            if (AiClass) {
                // Make it globally accessible if not already defined
                 if (typeof window.GoogleGenerativeAI === 'undefined') {
                    window.GoogleGenerativeAI = AiClass;
                    console.log("Google AI SDK loaded (as GoogleGenerativeAI) via dynamic import.");
                    // Optionally enable AI features UI now if needed (e.g., chat button)
                    document.dispatchEvent(new CustomEvent('ai-sdk-loaded'));
                 }
            } else {
                 console.warn(`Loaded Google AI SDK module from ${sdkUrl}, but couldn't find GoogleGenerativeAI class.`);
                 document.dispatchEvent(new CustomEvent('ai-sdk-load-failed'));
            }
        } catch (err) {
            console.error("Failed to load Google AI SDK module:", err);
            document.dispatchEvent(new CustomEvent('ai-sdk-load-failed', { detail: err.message }));
        }
    </script>
	 
</head>
 
<body>
 
    <div class="header" id="header">
        <div>
            <!-- NEW: Bookshelf Button -->
            <button id="bookshelfButton" class="icon-button" title="Open Bookshelf">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M4,2H20A2,2 0 0,1 22,4V20A2,2 0 0,1 20,22H4A2,2 0 0,1 2,20V4A2,2 0 0,1 4,2M6,4V20H11V4H6M13,4V11H18V4H13M13,13V20H18V13H13Z" /></svg>
            </button>
            <button id="bookmarksButton" class="toggle-bookmarks" title="Bookmarks"><svg data-v-71c99c82="" version="1.1" viewBox="0 0 24 24" class="svg-icon svg-fill" focusable="false"><path pid="0" d="M5.7 3H4.4C3.5 3 3 3.5 3 4.3v1.3C3 6.5 3.5 7 4.3 7h1.3C6.5 7 7 6.3 7 5.7V4.4C7 3.5 6.5 3 5.7 3m14.2 0h-9.8C9.4 3 9 3.5 9 4.3v1.3c0 .9.4 1.4 1.1 1.4h9.8c.7 0 1.1-.7 1.1-1.3V4.4c0-.9-.4-1.4-1.1-1.4M4.3 10c-.8 0-1.3.5-1.3 1.3v1.3c0 .9.5 1.4 1.3 1.4h1.3c.9 0 1.4-.7 1.4-1.3v-1.4c0-.8-.5-1.3-1.3-1.3H4.3zm15.6 0h-9.8c-.7 0-1.1.5-1.1 1.3v1.3c0 .9.4 1.4 1.1 1.4h9.8c.7 0 1.1-.7 1.1-1.3v-1.4c0-.8-.4-1.3-1.1-1.3M5.7 17H4.4c-.9 0-1.4.5-1.4 1.3v1.3c0 .8.5 1.3 1.3 1.3h1.3c.9.1 1.4-.6 1.4-1.2v-1.3c0-.9-.5-1.4-1.3-1.4m14.2 0h-9.8c-.7 0-1.1.5-1.1 1.3v1.3c0 .9.4 1.4 1.1 1.4h9.8c.7 0 1.1-.7 1.1-1.3v-1.3c0-.9-.4-1.4-1.1-1.4"></path></svg></button> 
            <button id="pdf-title" style="align-self: left;" title="Open Bookshelf">No PDF Loaded</button>
        </div>
        
        <div class="controls">
            <button id="prev" style="float: left;" title="Previous Page">‚óÄ</button>
            <div id="pageNav" style="float: left;">
            <div><span id="page_num" >1</span> / <span id="page_count">0</span></div>
            </div>
            <button id="next" style="float: left;" title="Next Page">‚ñ∂</button>
        </div>
        <div><button id="toggle-search" class="icon-button" title="Search"><svg data-v-2de4339a="" version="1.1" viewBox="0 0 24 24" class="svg-icon svg-fill" focusable="false"><path pid="0" d="M15.49 17.61A8.144 8.144 0 0111.14 19c-4.452-.102-8.038-3.625-8.14-8 .036-4.35 3.575-7.89 8-8 4.425.112 7.965 3.65 8 8a7.813 7.813 0 01-1.388 4.499l4.451 4.45-2.121 2.122-4.46-4.46zM11.104 17c3.3-.09 5.919-2.757 5.895-6-.026-3.263-2.681-5.916-6-6-3.319.083-5.973 2.737-6 6 .077 3.281 2.766 5.923 6.105 6z"></path></svg></button></div>
    </div>
	<div class="main-body">
		<div id="bookmarksMenu" class="panel bookmarks-panel">
 			<div id="bookmarksContent" class="content">
				<!-- Your bookmark buttons go here -->
			</div>
		</div>
		<div id="canvasStuff">
			<div class="canvas-container" id="canvasContainer">
				<canvas id="the-canvas"></canvas>
				<div id="text-layer" class="textLayer"></div>
			</div>
		</div>
		<div id="search-panel" class=" panel search-panel">
			<div class="search-container">
					<input type="text" id="search-input" placeholder="Enter search term...">
					<button id="clearSearch" class="clear-button" aria-label="Clear search">x</button>
					<button id="search-button">Search</button>
			</div>
			<div id="searching-message">
				<div id="progress-container">
					<div id="progress-bar"></div>
				</div>
			</div>
			<div class="search-results">
				<ul id="search-results-list"></ul>
			</div>
			</div>
	</div>

	<!-- MODIFIED: Bookshelf Modal -->
	<div id="bookshelf-modal" style="display: none;">
        <div id="bookshelf-content">
            <div class="bookshelf-header">
                <h2>My Bookshelf</h2>
                <button id="close-bookshelf-btn" title="Close Bookshelf">√ó</button>
            </div>
            <div class="bookshelf-actions">
                 <input type="file" id="fileInput" accept=".pdf" style="display: none;">
                 <button id="upload-pdf-btn">Upload New PDF</button>
                 <input type="text" id="new-collection-name" placeholder="New collection name...">
                 <button id="add-collection-btn">Create Collection</button>
            </div>
            <div class="bookshelf-body">
                <div id="collections-list" class="bookshelf-column">
                    <!-- Collections will be populated here -->
                </div>
                <!-- MODIFIED: This column now shows PDFs -->
                <div id="pdfs-list" class="bookshelf-column">
                    <h3>All PDFs</h3>
                    <!-- PDFs will be populated here -->
                </div>
            </div>
            <div class="bookshelf-drop-zone">
                <p>... or drag and drop a PDF anywhere to upload it.</p>
            </div>
        </div>
    </div>
    
    <!-- MODIFIED: Context Menu for PDFs in Bookshelf -->
    <div id="pdf-context-menu" class="context-menu" style="display: none;">
        <div class="context-menu-item" id="move-pdf-item">
            <span>Move to ‚ñ∂</span>
            <div class="context-submenu">
                <!-- Submenu with collections will be populated here -->
            </div>
        </div>
    </div>

	<footer class="footer-bar">
		<div class="footer-left">
			<button onclick="navigateToPage('NGSSReference.html')">NGSS Reference</button>
			<button onclick="navigateToPage('TXFlippingEbook.html')">TX Science</button>
			<button onclick="navigateToPage('FLFlippingEbook.html')">FL Science</button>
			<button onclick="navigateToPage('FlipbookAnything.html')"  class="active">Flipbook Anything!</button>
		</div>
			
	<div class="footer-center">
		<button id="pan-zoom-mode" title="Pan/Zoom Mode (Hold Shift)">üîç<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-move" viewBox="0 0 24 24"><polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="15 19 12 22 9 19"/><polyline points="19 9 22 12 19 15"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/></svg>
            Mode</button>
        <button id="zoom-out" title="Zoom Out">üîç-</button>
        <input type="range" id="zoom-slider" min="1" max="4" step="0.25" value="1" title="Zoom Level">
        <button id="zoom-in" title="Zoom In">üîç+</button>
        <button id="text-select-mode" class="active" title="Text Selection Mode (Release Shift)">I Text Mode</button>
    </div>

		<div class="footer-right">
		
			<button id="theme-toggle" aria-label="Switch to light theme" title="Toggle Theme">‚òÄÔ∏è</button>
			<button id="spread-toggle" aria-label="Toggle Spread Layout" title="Toggle Page Spread">Toggle Spread</button>
            <button id="chat-toggle-btn" aria-label="Open AI Chat" title="Chat about this PDF">
                <i class="fas fa-comments"></i>
            </button>
		</div>
	</footer>

    <div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 9998;">
        <div id="loadingIndicator" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
            <div class="spinner"></div>
            <p>Loading ...</p>
        </div>
    </div>
	
	<!-- MODIFIED: Chat Modal with Context Area -->
    <div id="chat-modal" style="display: none;">
        <div id="chat-header">
            <span>AI Chat</span>
            <select id="chat-model-selector" title="Select AI Model">
				<option value="gemini-2.0-flash">gemini-2.0-flash</option>
				<option value="gemini-2.5-flash">gemini-2.5-flash</option>
				<option value="gemini-2.5-pro">gemini-2.5-pro</option>
            </select>
            <button id="chat-close-btn" aria-label="Close Chat">√ó</button>
        </div>
        <div id="chat-log">
            <p class="chat-notice">Load a PDF and ask a question. Add more documents to the context for multi-file analysis.</p>
        </div>
        <div id="chat-context-area">
             <div id="chat-context-header">
                <span>Chat Context:</span>
                <button id="manage-context-btn">Add PDFs...</button>
             </div>
             <div id="chat-context-list">
                <!-- Context PDFs will be listed here -->
             </div>
             <div id="chat-context-selector" class="modal-basic" style="display:none;">
                <div class="modal-content-basic">
                    <h4>Select PDFs/Collections to Add to Context</h4>
                    <div id="context-selector-list"></div>
                    <button id="close-context-selector-btn">Done</button>
                </div>
             </div>
        </div>
        <div id="chat-input-area">
            <textarea id="chat-input" placeholder="Ask about the PDF(s) in context..." rows="2"></textarea>
            <button id="chat-send-btn" aria-label="Send Message">
                <i class="fas fa-paper-plane"></i> Send
            </button>
        </div>
         <div id="chat-thinking" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i> AI is thinking...
        </div>
        <div id="chat-error" class="chat-error-msg" style="display: none;">
        </div>
    </div>

    <script src="panzoom.min.js"></script>
    <script src="db.js"></script>
    <script src="fbAI_script.js"></script>
</body>
 
</html>